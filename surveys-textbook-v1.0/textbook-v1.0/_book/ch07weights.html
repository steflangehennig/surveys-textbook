<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Survey Methods for Social Scientists - 8&nbsp; Survey Weighting</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ch08measurement.html" rel="next">
<link href="./ch06sampling.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part_design.html">Introduction to Survey Design</a></li><li class="breadcrumb-item"><a href="./ch07weights.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Survey Weighting</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Survey Methods for Social Scientists</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Survey Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch01intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch00setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Cleaning and Recoding</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch02psych_response.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Psychology of Survey Response Response</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch03ethics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Survey Ethics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Survey Design</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch04q_design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Questionnaire Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch05modes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Survey Modes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch06sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Survey Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch07weights.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Survey Weighting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch08measurement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Measurement &amp; Item Scaling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Survey Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch09hyp_analysis_rep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Learning Objectives</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#step-by-step-guide-to-creating-basic-rake-weights-in-r" id="toc-step-by-step-guide-to-creating-basic-rake-weights-in-r" class="nav-link active" data-scroll-target="#step-by-step-guide-to-creating-basic-rake-weights-in-r"><span class="header-section-number">8.1</span> Step-By-Step Guide to Creating Basic Rake Weights in R</a></li>
  <li><a href="#import-your-survey-data-into-r" id="toc-import-your-survey-data-into-r" class="nav-link" data-scroll-target="#import-your-survey-data-into-r"><span class="header-section-number">8.2</span> Import your survey data into R</a></li>
  <li><a href="#save-your-target-population-demographic-parameters" id="toc-save-your-target-population-demographic-parameters" class="nav-link" data-scroll-target="#save-your-target-population-demographic-parameters"><span class="header-section-number">8.3</span> Save Your Target Population Demographic Parameters</a>
  <ul class="collapse">
  <li><a href="#saving-new-vectors-with-target-population-demographic-values" id="toc-saving-new-vectors-with-target-population-demographic-values" class="nav-link" data-scroll-target="#saving-new-vectors-with-target-population-demographic-values"><span class="header-section-number">8.3.1</span> Saving New Vectors With Target Population Demographic Values</a></li>
  </ul></li>
  <li><a href="#calculating-your-rake-weights" id="toc-calculating-your-rake-weights" class="nav-link" data-scroll-target="#calculating-your-rake-weights"><span class="header-section-number">8.4</span> Calculating Your Rake Weights</a></li>
  <li><a href="#reviewing-the-newly-created-survey-weights" id="toc-reviewing-the-newly-created-survey-weights" class="nav-link" data-scroll-target="#reviewing-the-newly-created-survey-weights"><span class="header-section-number">8.5</span> Reviewing the Newly Created Survey Weights</a></li>
  <li><a href="#evaluating-influence-of-weights-on-reported-mean-values-in-the-sample-data---smallish-weights" id="toc-evaluating-influence-of-weights-on-reported-mean-values-in-the-sample-data---smallish-weights" class="nav-link" data-scroll-target="#evaluating-influence-of-weights-on-reported-mean-values-in-the-sample-data---smallish-weights"><span class="header-section-number">8.6</span> Evaluating Influence of Weights on Reported Mean Values in the Sample Data - Smallish Weights</a></li>
  <li><a href="#create-new-weighting-scheme-that-incorporates-more-demographic-variables" id="toc-create-new-weighting-scheme-that-incorporates-more-demographic-variables" class="nav-link" data-scroll-target="#create-new-weighting-scheme-that-incorporates-more-demographic-variables"><span class="header-section-number">8.7</span> Create New Weighting Scheme That Incorporates More Demographic Variables</a></li>
  <li><a href="#concluding-thoughts" id="toc-concluding-thoughts" class="nav-link" data-scroll-target="#concluding-thoughts"><span class="header-section-number">8.8</span> Concluding Thoughts</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Survey Weighting</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="step-by-step-guide-to-creating-basic-rake-weights-in-r" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="step-by-step-guide-to-creating-basic-rake-weights-in-r"><span class="header-section-number">8.1</span> Step-By-Step Guide to Creating Basic Rake Weights in R</h2>
<p><strong>Note: This tutorial uses the <code>anesrake</code> package to calculate the survey weights. They are many other packages to calculate weights so this is just one possible approach that could successfully be used to create survey weights.</strong></p>
<p>Survey weights are widely used in survey research for a variety of purposes. In this tutorial, we will be focusing on one specific form of survey weights called a “rake weight”. Rake weights are typically used to make the survey sample match the target population on a set of demographic, and sometimes attitudinal, measures. They are used to ensure the sample’s demographics match the target population’s demographics. This numerical correction will change how much each individual case in your dataset is contributing to the overall, or sub-group, mean values across your sample data.</p>
<p>First, we load necessary packages to compute and analyze the weights. If a package is not installed on your machine, you must first install it before this chunk of code will run.</p>
</section>
<section id="import-your-survey-data-into-r" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="import-your-survey-data-into-r"><span class="header-section-number">8.2</span> Import your survey data into R</h2>
<p>We need to import our survey data into R. The way we do this will vary by the format of your data, but in this case the data is saved as a “.dta” file so we will use the <code>haven</code> package to import it.</p>
<p>You should always examine your data and the base R function <code>head</code> shows the first 5 cases along with all of your column labels.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "caseid"         "pid_4"          "ideo5"          "gov_choice"    
 [5] "prop_111"       "prop_112"       "trump_app"      "hick_app"      
 [9] "gardner_app"    "cong_app"       "scotus_app"     "pot_law"       
[13] "gambling"       "fracking"       "gun_control"    "anger"         
[17] "pride"          "hope"           "disgust"        "worry"         
[21] "trump_app2"     "hick_app2"      "gardner_app2"   "cong_app2"     
[25] "scotus_app2"    "pot_law2"       "gambling2"      "fracking2"     
[29] "gun_control2"   "old_weight_old" "pid_x"          "sex"           
[33] "race_4"         "speakspanish"   "marstat"        "child18"       
[37] "employ"         "faminc_new"     "casscd"         "religiosity"   
[41] "age_group"      "educ"          </code></pre>
</div>
</div>
</section>
<section id="save-your-target-population-demographic-parameters" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="save-your-target-population-demographic-parameters"><span class="header-section-number">8.3</span> Save Your Target Population Demographic Parameters</h2>
<p>You will need to know the target population proportion for each of the variables you wish to weight your sample data on. How easy it will be to find your population values will be based on your specific target population.</p>
<p>Some populations will be relatively easy to find (e.g.&nbsp;think adult demographic proportions in the United States from the Census, CPS, or ACS results and all the sub-geographic levels that accompany them), but others won’t be as easy. Sometimes, you cannot know your target population proportions so in those cases you will not be able to weight your survey sample data.</p>
<p>In this chunk of R code, we are creating the target population parameters for two specific demographic variables measured in our sample political poll data. This was a political poll conducted in October 2018 with the sample consisting of likely Colorado voters in the then upcoming 2018 election. This gubernatorial election year poll measured multiple things including: - 2018 Colorado Gubernatorial Preference - Jared Polis or Walker Stapleton - Policy Questions: Marijuana Legalization, Fracking, Gun Control laws - Approval ratings: President Donald Trump, Governor John Hickenlooper (at the time), US Congress - Demographic questions for survey weighting purposes</p>
<section id="saving-new-vectors-with-target-population-demographic-values" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="saving-new-vectors-with-target-population-demographic-values"><span class="header-section-number">8.3.1</span> Saving New Vectors With Target Population Demographic Values</h3>
<p>Using this data, let’s create some survey weights. To illustrate the principle, we will start with basic weights using just two demographic variables commonly used in calculating survey weights: sex (unfortunately only biological sex was collected in this survey) and age (split into 5 categories). We must save a vector of data with the target population demographic proportions, so in this case we will save two vectors one called <code>sex</code> and one called <code>age_group</code>.</p>
<p>There are two critical things to get correct in this step.</p>
<p><strong>1. Matching Names</strong> The names we give these vectors matter and must match the names of the appropriate demographic variable in your sample data. Since the vector names we chose were sex and age_group, the variable names in the sample data must be exactly sex and age_group. Otherwise, the code will not be able to match the two and will fail.</p>
<p><strong>2. Matching Orders</strong> The second critical thing to get correct is the order the proportion values are entered into the vector must match the order the proportion values are stored in the sample data. In this example, the order of proportions stored in the sex variable in the sample data is (female, male) so the values we give the sex vector must be in that exact order as well. The same is true for the age_group variable, which has 5 groups in the sample data: 18-29, 30-39, 40-49, 50-64, 65+. The proportion order in our vector for the age_group must match that exactly as well otherwise you are creating incorrect weights or best-case scenario getting an error message.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">525</span>, .<span class="dv">475</span>)  <span class="co">#Target values for females and males; label order (female, male)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(sex) <span class="co">#proportions should = 1 so this checks that it does</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>age_group  <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">182</span>, .<span class="dv">203</span>, .<span class="dv">17</span>, .<span class="dv">218</span>, .<span class="dv">227</span>)  <span class="co">#Target values for 5 age groups; 18-29, 30-39, 40-49, 50-64, 65+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(age_group) <span class="co">#proportions should = 1 so this checks that it does</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>First, let’s look at the unweighted values in both the age and sex variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shows the unweighted size of the age_group demographics</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sample <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  age_group     n proportion
  &lt;dbl+lbl&gt; &lt;int&gt;      &lt;dbl&gt;
1 1 [18-29]    33     0.0412
2 2 [30-39]   101     0.126 
3 3 [40-49]   118     0.148 
4 4 [50-64]   306     0.382 
5 5 [65+]     242     0.302 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shows the unweighted size of the sex demographics</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sample <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  sex            n proportion
  &lt;dbl+lbl&gt;  &lt;int&gt;      &lt;dbl&gt;
1 1 [Female]   423      0.529
2 2 [Male]     377      0.471</code></pre>
</div>
</div>
</section>
</section>
<section id="calculating-your-rake-weights" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="calculating-your-rake-weights"><span class="header-section-number">8.4</span> Calculating Your Rake Weights</h2>
<p>Now that we have our target population parameters saved in vectors for each demographic variable we plan to weight our survey data on and our sample data with matching names and orders, we can begin to create our survey weights.</p>
<p><strong>1. Create List</strong> First, we create a list that merges the two demographic vectors for use in the raking process. Remember, this names must match the column names in the sample data. We give this list the name of <code>targets</code> to reflect this is the target population parameters we want to match the sample data to. We then give the column names to match with the sample data.</p>
<p><strong>2. Calculate the Weights</strong> Now, it is time to create some survey weights using the <code>anesrake</code> function. This function has many possible items that could be used, with all the possible items listed in the following R chunk. You should view the R documentation for all possible things it can do.</p>
<p>For our purposes, we will be focusing on a few things that will be noted. We will calculate a new dataframe called <code>myweights</code> where we input the <sub>targets</sub> list, the name of our sample data <code>cpc</code>, a caseid value that uniquely identifies each case, the <code>cap</code> item tells the function to cape the size of the survey weights at 8 and not allow any case to have a weight larger than that value. The <code>type</code> item tells the function how it should handle, if at all, a target population demographic that is very close to the sample value for that same demographic.</p>
<p>You’ll see in the output once you run the <code>anesrake</code> function how many iterations it took for the raking to converge on this specific set of weights. Here, it took 15 iterations across the two target demographic variables.</p>
<p><strong>3. Save Weights in Sample Data</strong> Next, we save that newly created weight as a new variable in our existing sample data, and now we have a weight variable that we can use in our analysis of the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Now we save these values as a list and call the list targets</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Step 1: Save the target list </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>targets <span class="ot">&lt;-</span> <span class="fu">list</span>(sex, age_group)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># remember, these names will have to match</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(targets) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sex"</span>, <span class="st">"age_group"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#anesrake(targets, dataframe, caseid, weightvec = NULL, cap = 5,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#verbose = FALSE, maxit = 1000, type = "pctlim", pctlim = 5,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#nlim = 5, filter = 1, choosemethod = "total", iterate = TRUE)</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Step 2 - Calculate the Rake Weight</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1599385</span>) <span class="co">#Set the seed for replication  </span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>myweights <span class="ot">&lt;-</span> <span class="fu">anesrake</span>(targets, sample, </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">caseid =</span> sample<span class="sc">$</span>caseid, <span class="at">cap =</span> <span class="dv">8</span>, <span class="at">type =</span> <span class="st">"nolim"</span>, <span class="at">pctlim=</span>.<span class="dv">05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Raking converged in 12 iterations"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step 3 - Save the Rake Weight at the end of your sample data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>sample<span class="sc">$</span>weight  <span class="ot">&lt;-</span> <span class="fu">unlist</span>(myweights[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reviewing-the-newly-created-survey-weights" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="reviewing-the-newly-created-survey-weights"><span class="header-section-number">8.5</span> Reviewing the Newly Created Survey Weights</h2>
<p>Before we start the analysis of the weighted data, let’s examine the newly created survey weights saved in our sample data.</p>
<p>With only 2 target weighting variables with 10 total categories combined between them, we can examine the weights individually by group. To do this, we will use the <code>srvyr</code> package to examine the weight size by the target groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Displays summary of the weight size to see range</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sample<span class="sc">$</span>weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5347  0.6086  0.6997  1.0000  1.0912  4.8008 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shows the weight size by demographic groups used in the weighting scheme</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>sample <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weight =</span> <span class="fu">survey_mean</span>(weight, <span class="at">na.rm =</span> T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
# Groups:   sex [2]
   sex        age_group weight weight_se
   &lt;dbl+lbl&gt;  &lt;dbl+lbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
 1 1 [Female] 1 [18-29]  4.22   0       
 2 1 [Female] 2 [30-39]  1.51   2.86e-17
 3 1 [Female] 3 [40-49]  1.09   0       
 4 1 [Female] 4 [50-64]  0.535  0       
 5 1 [Female] 5 [65+]    0.700  0       
 6 2 [Male]   1 [18-29]  4.80   0       
 7 2 [Male]   2 [30-39]  1.72   3.22e-17
 8 2 [Male]   3 [40-49]  1.24   0       
 9 2 [Male]   4 [50-64]  0.609  0       
10 2 [Male]   5 [65+]    0.796  0       </code></pre>
</div>
</div>
<p>Now we see the weight size for each of the 10 groups that we weighted our sample data on. Obviously, with more demographic variables including in the weighting scheme this list would get much more cumbersome but for pedagogical purposes it is important to look at these values to understand their meaning.</p>
<p>For females between the age of 18-29 the weight equals 4.21. This means that females between the ages of 18-29 are under-represented in the sample data since the value is over 1. Fundamentally what this means is that for each female between the ages of 18-29 in the sample data, they are “speaking” for 4.21 females between the age of 18-29 from the target population. Compare this value to females between the ages of 50 and 64 (group 4) who have a weight value of .53. This means that females in this age group were over-represented in the sample data since the weight value is under 1.</p>
<p>We should also look at the weighted demographic values to ensure the weights worked as we hope they do - i.e.&nbsp;the weighted sample demographic values match the target population values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shows the unweighted size of the age_group demographics</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>sample <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  age_group     n proportion
  &lt;dbl+lbl&gt; &lt;int&gt;      &lt;dbl&gt;
1 1 [18-29]    33     0.0412
2 2 [30-39]   101     0.126 
3 3 [40-49]   118     0.148 
4 4 [50-64]   306     0.382 
5 5 [65+]     242     0.302 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shows the weighted size of the age_group demographics</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>sample <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">survey_total</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  age_group     n  n_se proportion
  &lt;dbl+lbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
1 1 [18-29]  146. 24.9       0.182
2 2 [30-39]  162. 15.2       0.203
3 3 [40-49]  136  11.6       0.17 
4 4 [50-64]  174.  7.87      0.218
5 5 [65+]    182.  9.78      0.227</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Saves the weighted &amp; unweighted size of the age_group demographics</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ag_w<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">survey_total</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weighted_sample =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>ag_uw<span class="ot">&lt;-</span> sample <span class="sc">%&gt;%</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unweighted_sample =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>ag_combo<span class="ot">&lt;-</span><span class="fu">left_join</span>(ag_w, ag_uw, <span class="at">by =</span> <span class="st">"age_group"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_pop"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>ag_combo<span class="sc">$</span>ag_diff_per<span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span>(ag_combo<span class="sc">$</span>weighted_sample<span class="sc">-</span>ag_combo<span class="sc">$</span>unweighted_sample)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>ag_combo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
# Groups:   age_group [5]
  age_group     n  n_se weighted_sample n_pop unweighted_sample ag_diff_per
  &lt;dbl+lbl&gt; &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt; &lt;int&gt;             &lt;dbl&gt;       &lt;dbl&gt;
1 1 [18-29]  146. 24.9            0.182    33            0.0412       14.1 
2 2 [30-39]  162. 15.2            0.203   101            0.126         7.68
3 3 [40-49]  136  11.6            0.17    118            0.148         2.25
4 4 [50-64]  174.  7.87           0.218   306            0.382       -16.4 
5 5 [65+]    182.  9.78           0.227   242            0.302        -7.55</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ag_combo<span class="sc">$</span>weighted_sample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.182 0.203 0.170 0.218 0.227</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(targets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sex
[1] 0.525 0.475

$age_group
[1] 0.182 0.203 0.170 0.218 0.227</code></pre>
</div>
</div>
<p>We see that the weighted age_group values match the target population values we inputted earlier so this weighting scheme seems to be working in the way that we hoped it would.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shows the unweighted size of the sex demographics</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>sample <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  sex            n proportion
  &lt;dbl+lbl&gt;  &lt;int&gt;      &lt;dbl&gt;
1 1 [Female]   423      0.529
2 2 [Male]     377      0.471</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shows the weighted size of the sex demographics</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>sample <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">survey_total</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  sex            n  n_se proportion
  &lt;dbl+lbl&gt;  &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
1 1 [Female]   420  22.0      0.525
2 2 [Male]     380  20.4      0.475</code></pre>
</div>
</div>
<p>For the <code>sex</code> measure, the unweighted and weighted values matched nearly identically, but that is because the unweighted sample nearly matched the target population identically without any statistical correction. In these instances, it is common to drop the demographic variable that does not need much adjustment. The standard limit is 5% or less should not get an adjustment meaning that you should only apply weights with the target population values and the sample values are 5% points or more different.</p>
</section>
<section id="evaluating-influence-of-weights-on-reported-mean-values-in-the-sample-data---smallish-weights" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="evaluating-influence-of-weights-on-reported-mean-values-in-the-sample-data---smallish-weights"><span class="header-section-number">8.6</span> Evaluating Influence of Weights on Reported Mean Values in the Sample Data - Smallish Weights</h2>
<p>Now let’s see what impact these weights have on our sample values. First, we use the <code>surveys</code> package must create a new dataframe that incorporates the survey weights. Let’s call it <code>sample.weighted</code> to signal that this is the weighted version of the sample data.</p>
<p>We need to calculate the weighted and unweighted means of the same variable. Using the <code>fracking2</code> variable which measures support for fracking in the Colorado which various safety measures, we can compare the influence of the survey weights on the conclusions we would draw about support for fracking in Colorado.</p>
<p>Once we run the following R chunk, we see that there is virtually no difference between the weighted and unweighted estimates of how supportive Coloradoans are of fracking. Why is this? This occurs sometimes when the weights that applied simply do not change the sample composition enough to have an influence on the overall sample mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fracking_uw<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span> <span class="co">#Looks at the unweighted support for fracking in CO</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">unweight_support =</span> <span class="fu">mean</span>(fracking2, <span class="at">na.rm =</span> T))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>fracking_w<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span> <span class="co">#Looks at the weighted support for fracking in CO</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarise</span>(<span class="at">weight_support =</span> <span class="fu">survey_mean</span>(fracking2, <span class="at">na.rm =</span> T))</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>fracking_combo<span class="ot">&lt;-</span><span class="fu">cbind</span>(fracking_uw, fracking_w ) </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>fracking_combo <span class="ot">&lt;-</span> <span class="fu">mutate</span>(fracking_combo, <span class="at">difference =</span> weight_support <span class="sc">-</span> unweight_support)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>fracking_combo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  unweight_support weight_support weight_support_se  difference
1        0.5277778      0.5025514         0.0229558 -0.02522642</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gubernatorial Vote Choice - Weighted &amp; Unweighted </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>gov_w<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gov_choice)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gov_choice) <span class="sc">%&gt;%</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">survey_total</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_support =</span> n <span class="sc">/</span><span class="fu">sum</span>(n)) </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>gov_uw<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gov_choice) <span class="sc">%&gt;%</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gov_choice)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unweight_support =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>gov_combo<span class="ot">&lt;-</span><span class="fu">cbind</span>(gov_uw, gov_w) </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>gov_combo<span class="sc">$</span>diff <span class="ot">&lt;-</span> gov_combo<span class="sc">$</span>weight_support <span class="sc">-</span> gov_combo<span class="sc">$</span>unweight_support</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>gov_combo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  gov_choice   n unweight_support gov_choice         n      n_se weight_support
1          1 413          0.51625          1 438.30863 22.858613     0.54788579
2          2 346          0.43250          2 312.66152 17.843921     0.39082691
3          3  30          0.03750          3  31.10659  6.029889     0.03888324
4          4  11          0.01375          4  17.92325  7.817047     0.02240406
          diff
1  0.031635792
2 -0.041673095
3  0.001383243
4  0.008654059</code></pre>
</div>
</div>
</section>
<section id="create-new-weighting-scheme-that-incorporates-more-demographic-variables" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="create-new-weighting-scheme-that-incorporates-more-demographic-variables"><span class="header-section-number">8.7</span> Create New Weighting Scheme That Incorporates More Demographic Variables</h2>
<p>Typically, when creating survey weights you will include more than just 2 demographic variables into your weighting scheme. Here, we use 5 variables to create a new weight: sex, age, race/ethnicity, education, and partisanship.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Save new vectors with target population values for weights </span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">525</span>, .<span class="dv">475</span>)  <span class="do">##Target values for females and males; label order (female, male)</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>age_group  <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">132</span>, .<span class="dv">183</span>, .<span class="dv">15</span>, .<span class="dv">248</span>, .<span class="dv">287</span>)   <span class="co">#Target values for 5 age groups </span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>race_4 <span class="ot">&lt;-</span><span class="fu">c</span>(.<span class="dv">7143</span>, .<span class="dv">0501</span>, .<span class="dv">1768</span>, .<span class="dv">0588</span>) <span class="co">#Target values race/ethnic identities - white, black, Hispanic, all others</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>educ <span class="ot">&lt;-</span><span class="fu">c</span>(.<span class="dv">2075</span>, .<span class="dv">2445</span>, .<span class="dv">0828</span>, .<span class="dv">2398</span>, .<span class="dv">2254</span>) <span class="co">#Target values education - HS or less, Some college, AA, BA, Graduate degree</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>pid_4 <span class="ot">&lt;-</span><span class="fu">c</span>(.<span class="dv">3375</span>, .<span class="dv">2838</span>, .<span class="dv">335</span>, .<span class="dv">0437</span>) <span class="co">#Target values Party Registration - (Democrats, Independents, Republicans, All 3rd Parties)  </span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Combine the demographic vectors into a list</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>targets <span class="ot">&lt;-</span> <span class="fu">list</span>(sex, age_group, race_4, educ, pid_4)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># remember, these names will have to match the column names &amp; order in the sample data </span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(targets) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sex"</span>, <span class="st">"age_group"</span>, <span class="st">"race_4"</span>, <span class="st">"educ"</span>, <span class="st">"pid_4"</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1984</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>myweights <span class="ot">&lt;-</span> <span class="fu">anesrake</span>(targets, sample, </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">caseid =</span> sample<span class="sc">$</span>caseid, <span class="at">cap =</span> <span class="dv">8</span>, <span class="at">type =</span> <span class="st">"pctlim"</span>, <span class="at">pctlim=</span>.<span class="dv">05</span>)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Raking converged in 20 iterations"
[1] "Raking converged in 21 iterations"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>sample<span class="sc">$</span>full_weight  <span class="ot">&lt;-</span> <span class="fu">unlist</span>(myweights[<span class="dv">1</span>])</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sample<span class="sc">$</span>full_weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.3218  0.5685  0.7672  1.0000  1.0729  7.9999 </code></pre>
</div>
</div>
<p>Let’s look at how well the weights worked to match the sample data to the target population values for the <code>race4</code> and <code>educ5</code> measures.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shows the weighted size of the educ5 demographics</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="do">##We can also bind the two values together to calculate their differences </span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>ed_w<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(full_weight)) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(educ) <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">survey_total</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weighted_sample =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>ed_uw<span class="ot">&lt;-</span> sample <span class="sc">%&gt;%</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(educ) <span class="sc">%&gt;%</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unweighted_sample =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>ed_combo<span class="ot">&lt;-</span><span class="fu">left_join</span>(ed_w, ed_uw, <span class="at">by =</span> <span class="st">"educ"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(educ)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>ed_combo<span class="sc">$</span>ed_diff_per<span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span>(ed_combo<span class="sc">$</span>weighted_sample<span class="sc">-</span>ed_combo<span class="sc">$</span>unweighted_sample)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>ed_combo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
# Groups:   educ [5]
  educ             n.x  n_se weighted_sample   n.y unweighted_sample ed_diff_per
  &lt;dbl+lbl&gt;      &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt; &lt;int&gt;             &lt;dbl&gt;       &lt;dbl&gt;
1 1 [HS grad or… 166.  22.1           0.208     92             0.115       9.25 
2 2 [Some colle… 196.  17.2           0.244    187             0.234       1.07 
3 3 [AA degree]   66.2  7.29          0.0828    96             0.12       -3.72 
4 4 [BA]         192.  14.3           0.240    249             0.311      -7.15 
5 5 [Post-grad]  180.  14.3           0.225    176             0.22        0.540</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shows the weighted size of the race4 demographics</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="do">##We can also bind the two values together to calculate their differences </span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>r_w<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(full_weight)) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(race_4) <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">survey_total</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weighted_sample =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>r_uw<span class="ot">&lt;-</span> sample <span class="sc">%&gt;%</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(race_4) <span class="sc">%&gt;%</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unweighted_sample =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>r_combo<span class="ot">&lt;-</span><span class="fu">left_join</span>(r_w, r_uw, <span class="at">by =</span> <span class="st">"race_4"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(race_4)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>r_combo<span class="sc">$</span>r_diff_per<span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span>(r_combo<span class="sc">$</span>weighted_sample<span class="sc">-</span>r_combo<span class="sc">$</span>unweighted_sample)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>r_combo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
# Groups:   race_4 [4]
  race_4          n.x  n_se weighted_sample   n.y unweighted_sample r_diff_per
  &lt;dbl+lbl&gt;     &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt; &lt;int&gt;             &lt;dbl&gt;      &lt;dbl&gt;
1 1 [White]     571.  14.0           0.714    692            0.865     -15.1  
2 2 [Black]      40.1  9.97          0.0501    22            0.0275      2.26 
3 3 [Hispanic]  141.  25.1           0.177     41            0.0512     12.6  
4 4 [Other POC]  47.0  7.56          0.0588    45            0.0562      0.255</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shows the weighted size of the pid_4 registered voter variable </span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="do">##We can also bind the two values together to calculate their differences </span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>pid_w<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(full_weight)) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pid_4) <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">survey_total</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weighted_sample =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>pid_uw<span class="ot">&lt;-</span> sample <span class="sc">%&gt;%</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pid_4) <span class="sc">%&gt;%</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unweighted_sample =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>pid_combo<span class="ot">&lt;-</span><span class="fu">left_join</span>(pid_w, pid_uw, <span class="at">by =</span> <span class="st">"pid_4"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pid_4)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>pid_combo<span class="sc">$</span>pid_diff_per<span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span>(pid_combo<span class="sc">$</span>weighted_sample<span class="sc">-</span>pid_combo<span class="sc">$</span>unweighted_sample)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>pid_combo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
# Groups:   pid_4 [4]
  pid_4           n.x  n_se weighted_sample   n.y unweighted_sample pid_diff_per
  &lt;dbl+lbl&gt;     &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt; &lt;int&gt;             &lt;dbl&gt;        &lt;dbl&gt;
1 1 [Democrat]  270.  21.1           0.338    283            0.354        -1.62 
2 2 [Independe… 227.  17.2           0.284    214            0.268         1.63 
3 3 [Republica… 268.  19.8           0.335    266            0.332         0.250
4 4 [Other]      35.0  6.55          0.0437    37            0.0462       -0.255</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gubernatorial Vote Choice - Weighted &amp; Unweighted </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>gov_w<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(full_weight)) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gov_choice)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gov_choice) <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">survey_total</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_support =</span> n <span class="sc">/</span><span class="fu">sum</span>(n)) </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>gov_uw<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gov_choice) <span class="sc">%&gt;%</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gov_choice)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unweight_support =</span> n <span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>gov_combo<span class="ot">&lt;-</span><span class="fu">cbind</span>(gov_uw, gov_w) </span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>gov_combo<span class="sc">$</span>diff <span class="ot">&lt;-</span> gov_combo<span class="sc">$</span>weight_support <span class="sc">-</span> gov_combo<span class="sc">$</span>unweight_support</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>gov_outcome<span class="ot">&lt;-</span><span class="fu">cbind</span>(gov_combo<span class="sc">$</span>gov_choice, gov_combo<span class="sc">$</span>weight_support, gov_combo<span class="sc">$</span>unweight_support, gov_combo<span class="sc">$</span>diff) </span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gov_outcome) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"candidate"</span>, <span class="st">"weighted support"</span>, <span class="st">"unewighted support"</span>, <span class="st">"diff"</span>) </span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>gov_outcome</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     candidate weighted support unewighted support         diff
[1,]         1       0.50298793            0.51625 -0.013262068
[2,]         2       0.43459577            0.43250  0.002095774
[3,]         3       0.04328807            0.03750  0.005788066
[4,]         4       0.01912823            0.01375  0.005378227</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">####Comparing weighted to unweighted fracking support in Colorado </span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>fracking_uw<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span> <span class="co">#Looks at the unweighted support for fracking in CO</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">unweight_support =</span> <span class="fu">mean</span>(fracking2, <span class="at">na.rm =</span> T))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>fracking_w<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span> <span class="co">#Looks at the weighted support for fracking in CO</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(full_weight)) <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarise</span>(<span class="at">weight_support =</span> <span class="fu">survey_mean</span>(fracking2, <span class="at">na.rm =</span> T))</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>fracking_combo<span class="ot">&lt;-</span><span class="fu">cbind</span>(fracking_uw, fracking_w ) </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>fracking_combo <span class="ot">&lt;-</span> <span class="fu">mutate</span>(fracking_combo, <span class="at">frack_diff =</span> weight_support <span class="sc">-</span> unweight_support)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Do the same analysis for gun control then pot laws</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>gc_uw<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span> <span class="co">#Looks at the unweighted support for fracking in CO</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">unweight_support =</span> <span class="fu">mean</span>(gun_control2, <span class="at">na.rm =</span> T))</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>gc_w<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span> <span class="co">#Looks at the weighted support for fracking in CO</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(full_weight)) <span class="sc">%&gt;%</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarise</span>(<span class="at">weight_support =</span> <span class="fu">survey_mean</span>(gun_control2, <span class="at">na.rm =</span> T))</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>gc_combo<span class="ot">&lt;-</span><span class="fu">cbind</span>(gc_uw, gc_w ) </span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>gc_combo <span class="ot">&lt;-</span> <span class="fu">mutate</span>(gc_combo, <span class="at">gun_control_diff =</span> weight_support <span class="sc">-</span> unweight_support)</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>pl_uw<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span> <span class="co">#Looks at the unweighted support for fracking in CO</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">unweight_support =</span> <span class="fu">mean</span>(pot_law2, <span class="at">na.rm =</span> T))</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>pl_w<span class="ot">&lt;-</span>sample <span class="sc">%&gt;%</span> <span class="co">#Looks at the weighted support for fracking in CO</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">weights =</span> <span class="fu">c</span>(full_weight)) <span class="sc">%&gt;%</span></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarise</span>(<span class="at">weight_support =</span> <span class="fu">survey_mean</span>(pot_law2, <span class="at">na.rm =</span> T))</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>pl_combo<span class="ot">&lt;-</span><span class="fu">cbind</span>(pl_uw, pl_w ) </span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>pl_combo <span class="ot">&lt;-</span> <span class="fu">mutate</span>(pl_combo, <span class="at">pot_law_diff =</span> weight_support <span class="sc">-</span> unweight_support)</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>combo<span class="ot">&lt;-</span><span class="fu">cbind</span>(<span class="dv">100</span><span class="sc">*</span>(fracking_combo<span class="sc">$</span>frack_diff),<span class="dv">100</span><span class="sc">*</span>(gc_combo<span class="sc">$</span>gun_control_diff), <span class="dv">100</span><span class="sc">*</span>(pl_combo<span class="sc">$</span>pot_law_diff)) </span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(combo) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"fracking_diff"</span>, <span class="st">"gun_control_diff"</span>, <span class="st">"pot_law_diff"</span>) </span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>combo<span class="ot">&lt;-</span><span class="fu">round</span>(combo,<span class="dv">3</span>)</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>combo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     fracking_diff gun_control_diff pot_law_diff
[1,]         2.651            0.531       -0.303</code></pre>
</div>
</div>
<p>Above, shows the impact that the new weighting scheme had on the differences in support for fracking, new gun control policies, support for marijuana legalization and a tax revenue proposition on the upcoming ballot. For fracking, the weighted sample supported fracking 3.3 percentage points higher than the unweighted sample. While that might not seem like a large difference, in a polarized American electorate 3.3 percentage points easily be the differences between winning an election or going down in defeat.</p>
<p>The other three items all saw a decrease in support in the weighted data. Overall, the results showed increased support for a generally conservative supported issue, fracking, while revealing decreased support for 3 more liberal supported issues, gun control, marijuana legalization, and increased governmental spending. This is likely caused by weighting older voters to be</p>
<p>We can also use the newly created survey weights in regression analyses. To do so, you first must create a new weighted survey dataset that you then conduct the analysis on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using srvyr package to create a new weighted dataset for analysis purposes</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Step 1: Create Weighted Survey Data for Analysis</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>sample.weighted <span class="ot">&lt;-</span> sample <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> <span class="dv">1</span>, <span class="co"># 1 for no cluster ids; use this for a simple random sample </span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> full_weight, <span class="co"># No weight added</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="cn">NULL</span> <span class="co"># sampling was simple (no strata) </span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>nonweighted <span class="ot">&lt;-</span><span class="fu">lm</span>(gambling <span class="sc">~</span> pid_x <span class="sc">+</span> ideo5 <span class="sc">+</span> sex , <span class="at">data=</span>sample)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>weighted <span class="ot">&lt;-</span><span class="fu">lm</span>(gambling <span class="sc">~</span> pid_x <span class="sc">+</span> ideo5 <span class="sc">+</span> sex, <span class="at">data=</span>sample, <span class="at">weights=</span>sample<span class="sc">$</span>weight)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>weighted2 <span class="ot">&lt;-</span><span class="fu">lm</span>(gambling <span class="sc">~</span> pid_x <span class="sc">+</span> ideo5 <span class="sc">+</span> sex, <span class="at">data=</span>sample, <span class="at">weights=</span>sample<span class="sc">$</span>full_weight)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(nonweighted, weighted,  weighted2, <span class="at">type=</span><span class="st">"text"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
============================================================
                                    Dependent variable:     
                               -----------------------------
                                         gambling           
                                  (1)       (2)       (3)   
------------------------------------------------------------
pid_x                           -0.017    -0.010    -0.013  
                                (0.031)   (0.032)   (0.029) 
                                                            
ideo5                           -0.059    -0.065   -0.096** 
                                (0.051)   (0.051)   (0.047) 
                                                            
sex                             0.184**  0.215***   0.188** 
                                (0.080)   (0.080)   (0.079) 
                                                            
Constant                       2.391***  2.441***  2.591*** 
                                (0.153)   (0.154)   (0.157) 
                                                            
------------------------------------------------------------
Observations                      669       669       669   
R2                               0.015     0.018     0.025  
Adjusted R2                      0.011     0.013     0.021  
Residual Std. Error (df = 665)   1.030     1.020     0.998  
F Statistic (df = 3; 665)       3.481**  4.032***  5.678*** 
============================================================
Note:                            *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<p>Results are largely similar across the regression models, but there are some slight differences between the unweighted model and the two weighted ones. This happens because certain respondent’s opinions are being given more or less weight to the overall average relationship which can cause the conclusions you draw from your analysis to differ. This is one reason why it is critically important to create your survey weights using defensible target population values.</p>
</section>
<section id="concluding-thoughts" class="level2" data-number="8.8">
<h2 data-number="8.8" class="anchored" data-anchor-id="concluding-thoughts"><span class="header-section-number">8.8</span> Concluding Thoughts</h2>
<p>This is an important lesson for the application of the survey weights. The target population values that you weight your survey sample data to match can have profound implications on the conclusions you and others draw from your survey results. In the case, the decision to weight the survey to give more voice to the Republican members of the sample influenced the conclusions drawn about support for various policies being debated in the public realm. This makes it critically important to make sure that the target population values that are chosen are as accurate as possible and publicly defensible.</p>
<p>Overall, this tutorial has taken you through how to calculate survey weights using the <code>anesrake</code> package. Using a sample political poll, you hopefully learned how to create target demographic population vectors, which then merge with our sample demographic values. Following this, you learned how to calculate directly survey weights, evaluate the success/failure of the survey weighting process, and compare the impact of using the survey weight on the conclusions drawn from the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.0 (2023-04-21 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19044)

Matrix products: default


locale:
[1] LC_COLLATE=English_United Kingdom.utf8 
[2] LC_CTYPE=English_United Kingdom.utf8   
[3] LC_MONETARY=English_United Kingdom.utf8
[4] LC_NUMERIC=C                           
[5] LC_TIME=English_United Kingdom.utf8    

time zone: America/Denver
tzcode source: internal

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] stargazer_5.2.3   data.table_1.14.8 anesrake_0.80     weights_1.0.4    
 [5] Hmisc_5.1-0       survey_4.2-1      survival_3.5-5    Matrix_1.5-4     
 [9] srvyr_1.2.0       poliscidata_2.3.0 skimr_2.1.5       lubridate_1.9.2  
[13] forcats_1.0.0     stringr_1.5.0     purrr_1.0.1       readr_2.1.4      
[17] tibble_3.2.1      tidyverse_2.0.0   knitr_1.43        tidyr_1.3.0      
[21] dplyr_1.1.2       ggplot2_3.4.2     haven_2.5.2      

loaded via a namespace (and not attached):
 [1] tidyselect_1.2.0   bitops_1.0-7       fastmap_1.1.1      digest_0.6.32     
 [5] rpart_4.1.19       timechange_0.2.0   lifecycle_1.0.3    cluster_2.1.4     
 [9] gdata_2.19.0       magrittr_2.0.3     compiler_4.3.0     rlang_1.1.1       
[13] tools_4.3.0        plotrix_3.8-2      utf8_1.2.3         htmlwidgets_1.6.2 
[17] plyr_1.8.8         repr_1.1.6         abind_1.4-5        KernSmooth_2.23-20
[21] withr_2.5.0        foreign_0.8-84     nnet_7.3-18        fansi_1.0.4       
[25] jomo_2.7-6         caTools_1.18.2     xtable_1.8-4       colorspace_2.1-0  
[29] mice_3.16.0        MASS_7.3-58.4      scales_1.2.1       gtools_3.9.4      
[33] iterators_1.0.14   cli_3.6.1          crayon_1.5.2       rmarkdown_2.23    
[37] generics_0.1.3     rstudioapi_0.14    tzdb_0.4.0         minqa_1.2.5       
[41] DBI_1.1.3          splines_4.3.0      base64enc_0.1-3    mitools_2.4       
[45] vctrs_0.6.3        boot_1.3-28.1      glmnet_4.1-7       jsonlite_1.8.5    
[49] carData_3.0-5      car_3.1-2          hms_1.1.3          mitml_0.4-5       
[53] Formula_1.2-5      htmlTable_2.4.1    foreach_1.5.2      glue_1.6.2        
[57] pan_1.8            nloptr_2.0.3       codetools_0.2-19   stringi_1.7.12    
[61] gtable_0.3.3       shape_1.4.6        lme4_1.1-33        munsell_0.5.0     
[65] pillar_1.9.0       htmltools_0.5.5    gplots_3.1.3       R6_2.5.1          
[69] evaluate_0.21      lattice_0.21-8     backports_1.4.1    broom_1.0.5       
[73] descr_1.1.7        Rcpp_1.0.10        nlme_3.1-162       gridExtra_2.3     
[77] checkmate_2.2.0    xfun_0.39          pkgconfig_2.0.3   </code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ch06sampling.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Survey Sampling</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ch08measurement.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Measurement &amp; Item Scaling</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Survey Methods for Social Scientists (1e) was written by Carey E. Stapleton and Stefani Langehennig.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>